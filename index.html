<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SISTEMA VENTAS 4029</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f4f7f6; margin: 0; }
        .header { background: #003566; color: white; padding: 15px; text-align: center; border-bottom: 4px solid #ffc300; }
        .container { max-width: 450px; margin: auto; background: white; padding: 20px; min-height: 100vh; }
        input, select, button { width: 100%; padding: 14px; margin: 8px 0; border: 1px solid #ccc; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        button { background: #003566; color: white; font-weight: bold; border: none; cursor: pointer; }
        .btn-save { background: #28a745; margin-top: 10px; }
        .btn-excel { background: #000; border: 2px solid #ffc300; margin-top: 25px; height: 60px; font-size: 18px; color: #fff; }
        .hidden { display: none; }
        .reloj { font-size: 30px; font-weight: bold; color: #003566; margin: 20px 0; text-align: center; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 11px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .tabs { display: flex; gap: 5px; margin-bottom: 15px; }
        .tabs button { background: #e9ecef; color: #333; font-size: 12px; padding: 10px; }
        .tabs button.active { background: #003566; color: white; }
        .link-rec { display: block; margin-top: 15px; font-size: 13px; color: #003566; cursor: pointer; text-decoration: underline; }
    </style>
</head>
<body onload="inicio()">

<div id="lSec" style="max-width:400px; margin:auto; padding:50px 20px; text-align:center;">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e0/Telcel_logo.svg/1200px-Telcel_logo.svg.png" width="160">
    <div id="rel" class="reloj">00:00:00</div>
    <div class="tabs">
        <button id="tabL" class="active" onclick="switchTab('L')">ENTRAR</button>
        <button id="tabR" onclick="switchTab('R')">REGISTRO</button>
    </div>
    <div id="formLogin">
        <input type="email" id="u" placeholder="Correo Electr칩nico">
        <input type="password" id="p" placeholder="Contrase침a">
        <button onclick="entrar()">ENTRAR AL PANEL</button>
        <span class="link-rec" onclick="switchTab('F')">쯆lvidaste tu contrase침a?</span>
    </div>
    <div id="formReg" class="hidden">
        <input type="email" id="regEmail" placeholder="Tu correo electr칩nico">
        <input type="password" id="regPass" placeholder="Crea una contrase침a">
        <input type="text" id="regResp" placeholder="쮺u치l es tu color favorito?">
        <button onclick="registrarUsuario()" style="background:#28a745;">CREAR CUENTA</button>
    </div>
    <div id="formForgot" class="hidden">
        <input type="email" id="fEmail" placeholder="Correo registrado">
        <input type="text" id="fResp" placeholder="Respuesta de seguridad">
        <button onclick="recuperar()" style="background:#ffc300; color:#000;">VER CONTRASE칌A</button>
        <span class="link-rec" onclick="switchTab('L')">Regresar</span>
    </div>
</div>

<div id="mSec" class="hidden">
    <div class="header">
        <h3 id="nombreUsuario" style="margin:0">SISTEMA 4029</h3>
        <small id="txtMes" style="font-weight:bold;"></small>
    </div>
    <div class="container">
        <form id="fReg">
            <input type="text" id="iProm" placeholder="NOMBRE DEL PROMOTOR" required>
            <select id="iTipo" onchange="verEq()" required>
                <option value="" disabled selected>-- TIPO --</option>
                <option value="AK">AK</option><option value="CHIP">CHIP</option>
                <option value="PORTA">PORTA</option><option value="REN">REN</option>
            </select>
            <input type="text" id="iTel" placeholder="TEL칄FONO (10)" maxlength="10" required>
            <input type="text" id="iIcc" placeholder="ICCID (19)" maxlength="19" required>
            <div id="gEq">
                <input type="text" id="iIme" placeholder="IMEI (15)" maxlength="15">
                <input type="text" id="iMar" placeholder="MARCA"><input type="text" id="iMod" placeholder="MODELO">
            </div>
            <input type="date" id="iFec">
            <button type="submit" class="btn-save">游 GUARDAR REGISTRO</button>
        </form>
        <table id="tVistas"><thead><tr><th>TEL</th><th>PROMOTOR</th><th>-</th></tr></thead><tbody></tbody></table>
        <button onclick="bajarExcel()" class="btn-excel">游 DESCARGAR EXCEL</button>
        <button onclick="salir()" style="margin-top:20px; background:#6c757d;">游뛁 Cerrar Sesi칩n</button>
    </div>
</div>

<script>
let uA = ""; 
function inicio(){
    if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }
    setInterval(()=>{document.getElementById('rel').innerText=new Date().toLocaleTimeString()},1000);
    const s = localStorage.getItem('ses_actual');
    if(s){ uA = s; mostrar(); }
}
function switchTab(t){
    document.getElementById('formLogin').classList.toggle('hidden', t !== 'L');
    document.getElementById('formReg').classList.toggle('hidden', t !== 'R');
    document.getElementById('formForgot').classList.toggle('hidden', t !== 'F');
}
function registrarUsuario(){
    const correo = document.getElementById('regEmail').value.trim().toLowerCase();
    const pass = document.getElementById('regPass').value.trim();
    const resp = document.getElementById('regResp').value.trim().toUpperCase();
    if(!correo || !pass || !resp) return alert("Completa los datos");
    let db = JSON.parse(localStorage.getItem('usuarios_db') || "{}");
    db[correo] = { p: pass, r: resp };
    localStorage.setItem('usuarios_db', JSON.stringify(db));
    alert("춰Registro exitoso!"); switchTab('L');
}
function entrar(){
    const correo = document.getElementById('u').value.trim().toLowerCase();
    const pass = document.getElementById('p').value.trim();
    let db = JSON.parse(localStorage.getItem('usuarios_db') || "{}");
    if(db[correo] && db[correo].p === pass){
        uA = correo; localStorage.setItem('ses_actual', uA); mostrar();
    } else { alert("Datos incorrectos"); }
}
function mostrar(){
    document.getElementById('lSec').className='hidden';
    document.getElementById('mSec').className='';
    document.getElementById('nombreUsuario').innerText = uA.split('@')[0].toUpperCase();
    pintarTabla();
}
function salir(){ localStorage.removeItem('ses_actual'); location.reload(); }
function verEq(){
    const t=document.getElementById('iTipo').value;
    document.getElementById('gEq').style.display=(t==='CHIP'||t==='PORTA')?'none':'block';
}
function pintarTabla(){
    const tbody=document.querySelector('#tVistas tbody'); tbody.innerHTML="";
    const d=JSON.parse(localStorage.getItem("db_datos_"+uA)||"[]");
    d.reverse().slice(0,5).forEach(x=>{
        tbody.innerHTML+=`<tr><td>${x.t}</td><td>${x.pr}</td><td><button onclick="borrar(${x.id})" style="background:red;padding:2px">X</button></td></tr>`;
    });
}
document.getElementById('fReg').onsubmit=function(e){
    e.preventDefault();
    const d=JSON.parse(localStorage.getItem("db_datos_"+uA)||"[]");
    d.push({pr: iProm.value.toUpperCase(), t:iTel.value, ic:iIcc.value, id:Date.now()});
    localStorage.setItem("db_datos_"+uA,JSON.stringify(d));
    alert("Guardado"); pintarTabla();
};
function bajarExcel(){
    const d=JSON.parse(localStorage.getItem("db_datos_"+uA)||"[]");
    const ws=XLSX.utils.json_to_sheet(d); const wb=XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb,ws,"Ventas"); XLSX.writeFile(wb,"Ventas.xlsx");
}
</script>
</body>
</html>
